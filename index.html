<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡¨åºŠç—…å²å¤±æ™ºè¨ºæ–·çµæ§‹æ€§å•å· - äº’å‹•å¼è©•ä¼°å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .progress-bar {
            background: #e5e7eb;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 30px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #3b82f6, #1e40af);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            color: #6b7280;
            font-size: 14px;
            margin-top: 10px;
        }

        .content {
            padding: 30px;
        }

        .section-title {
            font-size: 22px;
            font-weight: bold;
            color: #1e40af;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 3px solid #dbeafe;
        }

        .section-subtitle {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-label .required {
            color: #dc2626;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .question-item {
            padding: 20px;
            background: #f9fafb;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #3b82f6;
        }

        .question-header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .question-number {
            background: #3b82f6;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .question-text {
            font-weight: 500;
            color: #1f2937;
            flex: 1;
        }

        .question-note {
            font-size: 13px;
            color: #6b7280;
            margin: 8px 0 0 44px;
            font-style: italic;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-left: 44px;
            flex-wrap: wrap;
        }

        .radio-group.vertical {
            flex-direction: column;
            gap: 10px;
        }

        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .radio-label:hover {
            background: #e0e7ff;
        }

        .radio-label input[type="radio"] {
            margin-right: 8px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.4);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.4);
        }

        .info-box {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
        }

        .info-box h3 {
            color: #1e40af;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .info-box ul {
            list-style-position: inside;
            color: #374151;
        }

        .info-box li {
            margin-bottom: 5px;
            padding-left: 10px;
        }

        .results-container {
            padding: 30px;
        }

        .risk-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 5px solid #3b82f6;
        }

        .risk-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .risk-item {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border-radius: 10px;
        }

        .risk-label {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 8px;
        }

        .risk-value {
            font-size: 32px;
            font-weight: bold;
        }

        .risk-high { color: #dc2626; }
        .risk-moderate { color: #ea580c; }
        .risk-mild { color: #ca8a04; }
        .risk-low { color: #16a34a; }

        .probability-bars {
            margin: 20px 0;
        }

        .probability-item {
            margin-bottom: 20px;
        }

        .probability-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .probability-name {
            font-weight: 600;
            color: #374151;
        }

        .probability-percent {
            font-weight: bold;
            color: #3b82f6;
            font-size: 18px;
        }

        .probability-bar {
            width: 100%;
            height: 30px;
            background: #e5e7eb;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .probability-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #1e40af);
            border-radius: 15px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 12px;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .recommendations {
            margin: 20px 0;
        }

        .recommendation-item {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 12px;
            border-left: 4px solid;
        }

        .rec-urgent {
            background: #fef2f2;
            border-color: #dc2626;
        }

        .rec-important {
            background: #fff7ed;
            border-color: #ea580c;
        }

        .rec-clinical {
            background: #eff6ff;
            border-color: #3b82f6;
        }

        .rec-safety {
            background: #f0fdf4;
            border-color: #16a34a;
        }

        .rec-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .disclaimer {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .disclaimer h3 {
            color: #92400e;
            margin-bottom: 10px;
        }

        .disclaimer ul {
            list-style-position: inside;
            color: #78350f;
        }

        .disclaimer li {
            margin-bottom: 5px;
        }

        .symptoms-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .symptoms-table th {
            background: #f3f4f6;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
        }

        .symptoms-table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
            color: #4b5563;
        }

        .symptoms-table tr:last-child td {
            border-bottom: none;
        }

        .symptom-positive {
            color: #dc2626;
            font-weight: 600;
        }

        .hidden {
            display: none;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
            }
            .btn {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            .radio-group {
                flex-direction: column;
            }
            .button-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“‹ è‡¨åºŠç—…å²å¤±æ™ºè¨ºæ–·çµæ§‹æ€§å•å·</h1>
            <p>Interactive Assessment Tool - äº’å‹•å¼è©•ä¼°å·¥å…·</p>
        </div>

        <div class="progress-bar" id="progressBar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText"></div>

        <!-- æ­¥é©Ÿ0: åŸºæœ¬è³‡æ–™ -->
        <div id="step0" class="content">
            <div class="info-box">
                <h3>ğŸ“Œ è©•ä¼°èªªæ˜</h3>
                <ul>
                    <li>æœ¬å•å·ç”¨æ–¼åˆæ­¥è©•ä¼°å¤±æ™ºç—‡é¢¨éšªï¼Œä¸èƒ½å–ä»£å°ˆæ¥­é†«ç™‚è¨ºæ–·</li>
                    <li>è«‹ç”±äº†è§£æ‚£è€…ç‹€æ³çš„å®¶å±¬æˆ–ç…§é¡§è€…å”åŠ©å¡«å¯«</li>
                    <li>è©•ä¼°ç´„éœ€15-20åˆ†é˜ï¼Œè«‹ä¾å¯¦éš›æƒ…æ³èª å¯¦ä½œç­”</li>
                    <li>æ‰€æœ‰è³‡æ–™å°‡åš´æ ¼ä¿å¯†ï¼Œåƒ…ä¾›è‡¨åºŠåƒè€ƒ</li>
                    <li>å®Œæˆå¾Œå¯ä¸‹è¼‰å®Œæ•´æ–‡å­—å ±å‘Šæˆ–åŒ¯å‡ºè³‡æ–™ä¾›åˆ†æ</li>
                    <li><strong>âœ¨ å¡«ç­”éç¨‹ä¸­å¯éš¨æ™‚è¿”å›ä¿®æ”¹ï¼Œå®Œæˆå¾Œä¹Ÿèƒ½å›åˆ°ä»»ä½•æ­¥é©Ÿé‡æ–°èª¿æ•´</strong></li>
                </ul>
            </div>

        <div class="info-box" style="background: #fff7ed; border-left-color: #f59e0b;">
                <h3>ğŸ’¡ æª”æ¡ˆè‡ªå‹•å„²å­˜è¨­å®š</h3>
                <ul>
                    <li><strong>Chrome/Edge</strong>ï¼šè¨­å®š â†’ ä¸‹è¼‰ â†’ è¨­å®šé è¨­ä¸‹è¼‰ä½ç½®ï¼ˆä¸å‹¾é¸ã€Œä¸‹è¼‰å‰è©¢å•ã€ï¼‰</li>
                    <li><strong>Firefox</strong>ï¼šè¨­å®š â†’ ä¸€èˆ¬ â†’ æª”æ¡ˆèˆ‡æ‡‰ç”¨ç¨‹å¼ â†’ é¸æ“‡ã€Œå„²å­˜æª”æ¡ˆè‡³ã€ä¸¦è¨­å®šè³‡æ–™å¤¾</li>
                    <li><strong>Safari</strong>ï¼šåå¥½è¨­å®š â†’ ä¸€èˆ¬ â†’ æª”æ¡ˆä¸‹è¼‰ä½ç½®</li>
                    <li>è¨­å®šå®Œæˆå¾Œï¼Œå ±å‘Šæœƒè‡ªå‹•ä¸‹è¼‰åˆ°æ‚¨æŒ‡å®šçš„è³‡æ–™å¤¾ï¼Œå®Œæˆå¾Œè‡ªå‹•è¿”å›é¦–é </li>
                </ul>
            </div>

            <!-- åŠ å…¥é€™å€‹æ–°çš„ info-box -->
            <div class="info-box" style="background: #e0f2fe; border-left-color: #0ea5e9;">
                <h3>â˜ï¸ é›²ç«¯å„²å­˜åŠŸèƒ½</h3>
                <ul>
                    <li>è©•ä¼°å®Œæˆå¾Œå¯é¸æ“‡ã€Œä¸Šå‚³åˆ°é›²ç«¯ã€è‡ªå‹•å„²å­˜</li>
                    <li>æ‰€æœ‰ä¸Šå‚³çš„è³‡æ–™æœƒè‡ªå‹•æ•´åˆæˆ Excel å ±è¡¨</li>
                </ul>
            </div>

            <div class="section-title">ğŸ‘¤ åŸºæœ¬è³‡æ–™</div>
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">ç—…æ‚£å§“å <span class="required">*</span></label>
                    <input type="text" id="patientName" class="form-input" placeholder="è«‹è¼¸å…¥å§“å">
                </div>
                <div class="form-group">
                    <label class="form-label">ç—…æ­·è™Ÿ <span class="required">*</span></label>
                    <input type="text" id="chartNumber" class="form-input" placeholder="è«‹è¼¸å…¥ç—…æ­·è™Ÿ">
                </div>
                <div class="form-group">
                    <label class="form-label">å‡ºç”Ÿæ—¥æœŸ <span class="required">*</span></label>
                    <input type="date" id="birthDate" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">æ€§åˆ¥ <span class="required">*</span></label>
                    <select id="gender" class="form-select">
                        <option value="">è«‹é¸æ“‡</option>
                        <option value="ç”·">ç”·</option>
                        <option value="å¥³">å¥³</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">æ•™è‚²ç¨‹åº¦</label>
                    <select id="education" class="form-select">
                        <option value="">è«‹é¸æ“‡</option>
                        <option value="ä¸è­˜å­—">ä¸è­˜å­—</option>
                        <option value="å°å­¸">å°å­¸</option>
                        <option value="åœ‹ä¸­">åœ‹ä¸­</option>
                        <option value="é«˜ä¸­è·">é«˜ä¸­è·</option>
                        <option value="å°ˆç§‘">å°ˆç§‘</option>
                        <option value="å¤§å­¸">å¤§å­¸</option>
                        <option value="ç ”ç©¶æ‰€ä»¥ä¸Š">ç ”ç©¶æ‰€ä»¥ä¸Š</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">è©•ä¼°æ—¥æœŸ</label>
                    <input type="date" id="assessmentDate" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">è³‡è¨Šæä¾›è€…å§“å <span class="required">*</span></label>
                    <input type="text" id="informantName" class="form-input" placeholder="å¡«å¯«è€…å§“å">
                </div>
                <div class="form-group">
                    <label class="form-label">èˆ‡æ‚£è€…é—œä¿‚ <span class="required">*</span></label>
                    <input type="text" id="informantRelation" class="form-input" placeholder="ä¾‹å¦‚ï¼šé…å¶ã€å­å¥³ã€ç…§é¡§è€…">
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="startAssessment()">
                    é–‹å§‹è©•ä¼° â†’
                </button>
            </div>
        </div>

        <!-- å•å·æ­¥é©Ÿ -->
        <div id="questionSteps" class="content hidden"></div>

        <!-- çµæœé é¢ -->
        <div id="resultsPage" class="content hidden"></div>
    </div>

    <script>
        // å…¨å±€è®Šæ•¸
        let currentStep = 0;
        let responses = {};
        let patientInfo = {};

        // å•å·çµæ§‹
        const questionSections = [
            {
                id: 'consciousness',
                title: 'ä¸€ã€æ„è­˜æˆ–ç¡çœ ç—‡ç‹€',
                subtitle: '(ä¸æ¸…æ¥šæˆ–æ˜¯ä¸ç¢ºå®šè«‹é¸å¦)',
                questions: [
                    { id: 'dlb1_1', text: 'ç™½å¤©å—œç¡æˆ–ç¶“å¸¸æ˜æ˜æ¬²ç¡', type: 'yesno' },
                    { id: 'dlb1_2', text: 'å¸¸å¸¸æ€ç·’é›œäº‚ç„¡ç« ï¼Œèªªè©±ä¸åˆé‚è¼¯', type: 'yesno' },
                    { id: 'dlb1_3', text: 'æ„è­˜æˆ–èªçŸ¥ç—‡ç‹€èµ·ä¼å¾ˆå¤§ï¼Œç”šè‡³ä¸€å¤©ä¹‹å…§å¥½å£å°±å·®å¾ˆå¤šå—ï¼Ÿ', type: 'noyes' },
                    { id: 'dlb1_4', text: 'ç¡è¦ºæ™‚å› ç‚ºå¤¢å¢ƒè€Œç”¢ç”Ÿä¸€äº›å‹•ä½œè¡Œç‚ºï¼Œä¾‹å¦‚ï¼šå–Šå«ã€æ®æ‹³ã€æ®èˆé›™è‡‚ã€èµ·èº«è·‘ç­‰', type: 'yesno' }
                ]
            },
            {
                id: 'motor',
                title: 'äºŒã€å‹•ä½œéšœç¤™ç—‡ç‹€',
                subtitle: '(ä¸æ¸…æ¥šæˆ–æ˜¯ä¸ç¢ºå®šè«‹é¸å¦)',
                questions: [
                    { id: 'dlb2_1', text: 'åè‘—æˆ–éœæ­¢ä¸å‹•çš„æ™‚å€™ï¼Œè‚¢é«”æˆ–é ­éƒ¨æœƒæ˜é¡¯åœ°é¡«æŠ–', type: 'yesno' },
                    { id: 'dlb2_2', text: 'å‹•ä½œè®Šå¾—ç·©æ…¢ï¼Œå°¤å…¶æ˜¯èµ·æ­¥ç‰¹åˆ¥å›°é›£ï¼Œé¢éƒ¨è¡¨æƒ…ä¹Ÿæ˜é¡¯æ¸›å°‘', type: 'yesno' },
                    { id: 'dlb2_3', text: 'å‹•ä½œè®Šå¾—åƒµç¡¬ï¼Œèµ°è·¯æ­¥ä¼è®Šå°èº«é«”æœƒå‰å‚¾', type: 'yesno' },
                    { id: 'dlb2_4', text: 'å‹•ä½œè®Šå¾—ä¸ç©©ï¼Œèµ°è·¯ä¸å¹³è¡¡ï¼Œæœ‰æ™‚å€™å¥½åƒè¦è·Œå€’æˆ–çœŸçš„è·Œå€’', type: 'yesno' }
                ]
            },
            {
                id: 'behavioral',
                title: 'ä¸‰ã€æƒ…ç·’è¡Œç‚ºç—‡ç‹€',
                subtitle: '(ä¸æ¸…æ¥šæˆ–æ˜¯ä¸ç¢ºå®šè«‹é¸å¦)',
                questions: [
                    { id: 'dlb3_1', text: 'æœ‰è¦–å¹»è¦ºï¼Œæœƒã€Œæ¸…æ¥šã€åœ°çœ‹è¦‹åˆ¥äººçœ‹ä¸åˆ°çš„äººã€å‹•ç‰©æˆ–å…¶ä»–ç‰©é«”', type: 'yesno', note: '(è¨»ï¼šåªåƒæ˜¯éå»çš„ç‰‡æ®µè¨˜æ†¶ä¸ç®—ï¼›åªå°ç©ºæ°£è¬›è©±ä¸ç®—ï¼›åŠå¤¢åŠé†’æˆ–æ˜¯è¦–åŠ›ä¸ä½³çœ‹åˆ°çš„é»‘å½±æˆ–éŒ¯è¦ºä¹Ÿä¸ç®—)' },
                    { id: 'dlb3_2', text: 'è®Šå¾—å¤šç–‘æˆ–å¦„æƒ³ï¼Œå¸¸å¸¸æœ‰ä¸€äº›èˆ‡äº‹å¯¦ä¸ç¬¦çš„æƒ³æ³•ï¼Œä¾‹å¦‚ï¼šéŒ¢è²¡è¢«å·æˆ–äººè¢«å‚·å®³', type: 'yesno' },
                    { id: 'dlb3_3', text: 'è®Šå¾—æƒ…ç·’ä½è½ã€æ†‚é¬±ã€æœ‰è² é¢æƒ³æ³•ï¼Œæˆ–æ˜¯å€¦æ€ ä¹åŠ›', type: 'yesno' },
                    { id: 'ftd3_4', text: 'è®Šå¾—èºå‹•ï¼Œæƒ…ç·’ä¸å®¹æ˜“æ§åˆ¶ï¼Œç”šè‡³æœƒç”¨è¨€èªæˆ–å‹•ä½œå‚·å®³åˆ¥äºº', type: 'yesno' },
                    { id: 'ftd3_5', text: 'è®Šå¾—å†·æ¼ ï¼Œå°å‘¨é‚Šçš„äº‹ç‰©å¤±å»å‹•åŠ›æˆ–èˆˆè¶£', type: 'yesno' },
                    { id: 'ftd3_6', text: 'è®Šå¾—ç¼ºä¹åŒç†å¿ƒï¼Œæ¯«ä¸åœ¨æ„å¤–ç•Œçš„æƒ³æ³•èˆ‡æ„Ÿå—ï¼Œä¹Ÿä¸æœƒåŒæƒ…åˆ¥äºº', type: 'yesno' },
                    { id: 'ftd3_7', text: 'ç”¢ç”Ÿæ€ªç•°è¡Œç‚ºã€é‡è¤‡çš„å‹•ä½œï¼Œæˆ–æ˜¯å¼·è¿«æ€§çš„è¨€èªæˆ–è¡Œç‚º', type: 'yesno' },
                    { id: 'ftd3_8', text: 'é£²é£Ÿå–œå¥½æ”¹è®Šï¼Œæˆ–æ›´é…—è¸æˆ–é…’ï¼Œä¸æ­£å¸¸åœ°åƒç”œé£Ÿï¼Œæˆ–å°‡ä¸å¯åƒçš„æ±è¥¿æ”¾å…¥å£è£¡', type: 'yesno' }
                ]
            },
            {
                id: 'autonomic',
                title: 'å››ã€è‡ªå¾‹ç¥ç¶“ç—‡ç‹€',
                subtitle: '(ä¸æ¸…æ¥šæˆ–æ˜¯ä¸ç¢ºå®šè«‹é¸å¦)',
                questions: [
                    { id: 'vad4_1', text: 'ç¶“å¸¸æœ‰æ’å°¿å•é¡Œ', type: 'yesno' },
                    { id: 'dlb4_2', text: 'ç¶“å¸¸é ­æšˆï¼Œå°¤å…¶æ˜¯åœ¨è®Šæ›å§¿å‹¢çš„æ™‚å€™', type: 'yesno' },
                    { id: 'dlb4_3', text: 'æ›¾æœ‰çŸ­æš«æ„è­˜å–ªå¤±', type: 'yesno' }
                ]
            },
            {
                id: 'memory',
                title: 'äº”ã€è¨˜æ†¶åŠ›ç—‡ç‹€',
                subtitle: '(ä¸æ¸…æ¥šæˆ–æ˜¯ä¸ç¢ºå®šè«‹é¸ä¸æœƒ)',
                questions: [
                    { id: 'ad5_1', text: 'æœƒå¿˜è¨˜ç†Ÿæ‚‰è¦ªäººæˆ–æœ‹å‹çš„åå­—å—ï¼Ÿ', type: 'noyes' },
                    { id: 'ad5_2', text: 'æœƒé‡è¤‡å•ç›¸åŒçš„å•é¡Œæˆ–è¬›ç›¸åŒçš„äº‹æƒ…å—ï¼Ÿ', type: 'noyes' },
                    { id: 'ad5_3', text: 'æœƒå¿˜è¨˜èˆ‡åˆ¥äººçš„é‡è¦ç´„æœƒå—ï¼Ÿ', type: 'noyes' },
                    { id: 'ad5_4', text: 'å­¸ç¿’å¦‚ä½•ä½¿ç”¨æ–°çš„å·¥å…·è¨­å‚™ï¼ˆä¾‹å¦‚ï¼šæ‰‹æ©Ÿæˆ–å…¶ä»–é›»å­ç”¢å“ï¼‰æœƒè®Šå¾—å›°é›£å—ï¼Ÿ', type: 'noyes' },
                    { id: 'ad5_5', text: 'æœƒå¸¸å¸¸å¿˜è¨˜ç‰©å“æ”¾ç½®ä½ç½®å—ï¼Ÿ', type: 'frequency3' },
                    { id: 'ad5_6', text: 'æœƒå¸¸å¸¸å¿˜è¨˜æœ€è¿‘ç™¼ç”Ÿçš„äº‹æƒ…å—ï¼Ÿ', type: 'frequency3' },
                    { id: 'ad5_7', text: 'æœƒå¸¸å¸¸å¿˜è¨˜é—œç“¦æ–¯æˆ–æ°´é¾é ­å—ï¼Ÿ', type: 'frequency3' },
                    { id: 'ad5_8', text: 'æœƒå› ç‚ºå›ç­”ä¸å‡ºå•é¡Œæˆ–æ˜¯åˆ†ä¸æ¸…æ¥šéå»ç¾åœ¨ï¼Œå°±äº‚ç·¨æ•…äº‹å—ï¼Ÿ', type: 'frequency3' }
                ]
            },
            {
                id: 'orientation',
                title: 'å…­ã€å®šå‘åŠ›ç—‡ç‹€',
                subtitle: '(ä¸æ¸…æ¥šæˆ–æ˜¯ä¸ç¢ºå®šè«‹é¸ä¸æœƒ)',
                questions: [
                    { id: 'ad6_1', text: 'æœƒå¿˜è¨˜æ­£ç¢ºçš„å¹´ä»½å’Œæœˆä»½å—ï¼Ÿ', type: 'noyes' },
                    { id: 'ad6_2', text: 'åœ¨ç†Ÿæ‚‰çš„ç’°å¢ƒï¼ˆä¾‹å¦‚ï¼šä½å®¶é™„è¿‘ï¼‰æœƒè¿·è·¯å—ï¼Ÿ', type: 'noyes' },
                    { id: 'ad6_3', text: 'å°‹æ‰¾ç‰©å“ï¼ˆä¾‹å¦‚ï¼šæ‰¾å†°ç®±æˆ–æ«ƒå­å…§ç‰©å“ï¼‰æœƒæœ‰å›°é›£å—ï¼Ÿ', type: 'noyes' },
                    { id: 'ad6_4', text: 'æœƒç„¡æ³•è¾¨èªè¦ªäººè‡‰å­”ã€è‡ªå®¶å»ºç¯‰æˆ¿é–“æˆ–è‡ªå·±çš„ç‰©å“å—ï¼Ÿ', type: 'noyes' },
                    { id: 'ad6_5', text: 'ç©ºé–“èªçŸ¥ï¼ˆä¾‹å¦‚ï¼šåœè»Šæœ‰å›°é›£æˆ–èº«è™•å±éšªåœ°æ–¹ä¸è‡ªçŸ¥ï¼‰æœ‰è®Šå·®å—ï¼Ÿ', type: 'noyes' }
                ]
            },
            {
                id: 'executive',
                title: 'ä¸ƒã€åˆ¤æ–·åŠ›èˆ‡åŸ·è¡ŒåŠŸèƒ½ç—‡ç‹€',
                subtitle: '(ä¸æ¸…æ¥šæˆ–æ˜¯ä¸ç¢ºå®šè«‹é¸ä¸æœƒ)',
                questions: [
                    { id: 'ftd7_1', text: 'æ‡‰å°é€²é€€ï¼ˆä¾‹å¦‚ï¼šåƒåŠ è¦ªæœ‹å¥½å‹å©šå–ªå–œæ…¶ï¼‰æœƒæœ‰ä¸é©ç•¶è¨€è¡Œèˆ‰æ­¢å—ï¼Ÿ', type: 'noyes' },
                    { id: 'vad7_2', text: 'åšå‡ºéŒ¯èª¤çš„åˆ¤æ–·æˆ–æ±ºå®šå—ï¼Ÿä¾‹å¦‚ï¼šè¢«é¨™ã€è²·ä¸é©å®œç‰©å“ã€ä¸é¡§å®‰å±ç­‰', type: 'noyes' },
                    { id: 'vad7_3', text: 'è™•ç†è¤‡é›œçš„è²¡å‹™ï¼Œä¾‹å¦‚ï¼šä¸ŠéŠ€è¡Œã€ç¹³è²»ã€é–‹æ”¯ç¥¨ç­‰æœƒè®Šå¾—å›°é›£å—ï¼Ÿ', type: 'noyes' },
                    { id: 'vad7_4', text: 'è®Šå¾—å¾ˆå›°é›£è¨ˆç•«å®‰æ’æˆ–ä¸‹æ±ºå®šå—ï¼Ÿ', type: 'decision' },
                    { id: 'vad7_5', text: 'è®Šå¾—ä¸çŸ¥äº‹æƒ…çš„è¼•é‡ç·©æ€¥ï¼ˆé‡è¦æ€§ï¼‰ï¼ŒæéŒ¯é †åºå—ï¼Ÿ', type: 'noyes' },
                    { id: 'vad7_6', text: 'æ“ä½œæ—¥å¸¸ç”Ÿæ´»ç”¨å“æ˜é¡¯æ¯”ä»¥å‰å›°é›£å—ï¼Ÿä¾‹å¦‚ï¼šä½¿ç”¨é›»è©±ã€é™æ§å™¨ï¼Œæˆ–å¾®æ³¢çˆç­‰', type: 'noyes' },
                    { id: 'vad7_7', text: 'é¢å°å•é¡Œè®Šå¾—ç„¡æ³•è§£æ±ºæˆ–æ€è€ƒè®Šå¾—æ²’æœ‰å½ˆæ€§ä¸çŸ¥è®Šé€šå—ï¼Ÿ', type: 'noyes' }
                ]
            },
            {
                id: 'language',
                title: 'å…«ã€èªè¨€åŠŸèƒ½ç—‡ç‹€',
                subtitle: '(ä¸æ¸…æ¥šæˆ–æ˜¯ä¸ç¢ºå®šè«‹é¸å¦æˆ–ä¸æœƒ)',
                questions: [
                    { id: 'ppa8_1', text: 'æƒ³è¦è¬›æŸå€‹åè©ä¾‹å¦‚äººåæˆ–ç‰©åå»å¸¸å¸¸è¬›ä¸å‡ºä¾†å—ï¼Ÿ', type: 'frequency3' },
                    { id: 'ppa8_2', text: 'èªªè©±æœƒè®Šå¾—å¾ˆå°‘æˆ–è®Šå¾—ä¸æµåˆ©ï¼Œç„¡æ³•å®Œæ•´åœ°è¬›ä¸€å€‹å¥å­å—ï¼Ÿ', type: 'noyes' },
                    { id: 'ppa8_3', text: 'èªªè©±è®Šå¾—å®¹æ˜“èªªéŒ¯è©±æˆ–æ–‡æ³•éŒ¯èª¤ï¼Ÿ', type: 'noyes' },
                    { id: 'ppa8_4', text: 'æœƒè®Šå¾—è½ä¸æ‡‚åˆ¥äººçš„è©±æˆ–ç„¡æ³•ç†è§£æ–‡æ„å—ï¼Ÿ', type: 'noyes' },
                    { id: 'ppa8_5', text: 'æœƒä¸€ç›´é‡è¤‡èªªåŒæ¨£çš„å­—å¥æˆ–é‡è¤‡åˆ¥äººçš„å­—å¥å—ï¼Ÿ', type: 'noyes' },
                    { id: 'ftd8_6', text: 'èªè¨€åŠŸèƒ½ç•°å¸¸æ˜¯å¦æœ€æ—©ç™¼ç”Ÿï¼Œè€Œä¸”æ¯”å…¶ä»–èªçŸ¥ç—‡ç‹€æ—©å¾ˆå¤šå—ï¼Ÿ', type: 'yesno' }
                ]
            },
            {
                id: 'adl',
                title: 'ä¹ã€æ—¥å¸¸ç”Ÿæ´»ç‹€æ³',
                subtitle: '(è«‹ç…§é¡§è€…å‹™å¿…ä¾ç—…æ‚£ç¾éšæ®µèƒ½åŠ›é¸æ“‡å…¶ä¸­ä¸€å€‹é …ç›®)',
                questions: [
                    { id: 'adl9_1', text: 'èƒ½ä¸Šè¡—è³¼ç‰©å—ï¼Ÿ', type: 'adl3', options: ['èƒ½ç¨ç«‹è³¼è²·ç”Ÿæ´»ç”¨å“', 'éœ€è¦æœ‰äººé™ªåŒæˆ–å”åŠ©', 'å®Œå…¨ä¸æœƒè³¼è²·'] },
                    { id: 'adl9_2', text: 'èƒ½å¤ è‡ªè¡Œå¤–å‡ºæ´»å‹•å—ï¼Ÿ', type: 'adl3', options: ['èƒ½ç¨ç«‹æ­è»Šæˆ–é¨/é–‹è»Š', 'éœ€è¦æœ‰äººé™ªåŒ', 'å®Œå…¨ä¸èƒ½å‡ºé–€'] },
                    { id: 'adl9_3', text: 'èƒ½å¤ æº–å‚™é£¯èœå—ï¼Ÿä¾‹å¦‚ä½œèœã€é»èœæˆ–å¤–ç‡´', type: 'adl4', options: ['ä¸é©ç”¨(å¹³å¸¸æ²’åœ¨åš)', 'æ­£å¸¸(å¯ä»¥ç¨ç«‹å®Œæˆ)', 'éƒ¨åˆ†è‡ªç†(éœ€è¦å”åŠ©æˆ–åªèƒ½åšç°¡å–®çš„)', 'ç„¡æ³•è‡ªç†(éœ€è¦åˆ¥äººç…®å¥½ã€æ“ºå¥½)'] },
                    { id: 'adl9_4', text: 'èƒ½å¤ åšå®¶äº‹å—ï¼Ÿä¾‹å¦‚æ”¶æ‹¾æˆ¿é–“ã€æ‰“æƒ', type: 'adl4', options: ['ä¸é©ç”¨(å¹³å¸¸æ²’åœ¨åš)', 'æ­£å¸¸(å¯ä»¥ç¨ç«‹å®Œæˆ)', 'éƒ¨åˆ†è‡ªç†(åªèƒ½åšç°¡å–®å®¶äº‹)', 'ç„¡æ³•è‡ªç†(å®Œå…¨éœ€è¦åˆ¥äººå”åŠ©)'] },
                    { id: 'adl9_5', text: 'èƒ½å¤ æ´—è¡£æœå—ï¼Ÿ', type: 'adl4', options: ['ä¸é©ç”¨(å¹³å¸¸æ²’åœ¨åš)', 'æ­£å¸¸(å¯ä»¥ç¨ç«‹å®Œæˆ)', 'éƒ¨åˆ†è‡ªç†(åªèƒ½æ´—å°ä»¶è¡£ç‰©)', 'ç„¡æ³•è‡ªç†(å®Œå…¨ä¾é åˆ¥äºº)'] },
                    { id: 'adl9_6', text: 'èƒ½å¤ ä½¿ç”¨é›»è©±æˆ–æ‰‹æ©Ÿå—ï¼Ÿ', type: 'adl3', options: ['æ­£å¸¸ä½¿ç”¨', 'åªæœƒæ¥è½æˆ–æ’¥ç†Ÿæ‚‰è™Ÿç¢¼', 'å®Œå…¨ä¸æœƒä½¿ç”¨'] },
                    { id: 'adl9_7', text: 'é‚„èƒ½å¤ è‡ªè¡Œæœç”¨è—¥ç‰©å—ï¼Ÿ', type: 'adl3', options: ['æ­£å¸¸æˆ–ä¸éœ€æœè—¥', 'éœ€è¦æé†’æ‰æœƒæœç”¨', 'éœ€è¦åˆ¥äººæº–å‚™æˆ–å®Œå…¨ä¾è³´'] },
                    { id: 'adl9_8', text: 'èƒ½å¤ è™•ç†éŒ¢è²¡å—ï¼Ÿ', type: 'adl3', options: ['èƒ½è™•ç†æ—¥å¸¸è³¼è²·åŠè²¡å‹™', 'åªèƒ½è™•ç†ç°¡å–®çš„é›¶éŒ¢äº¤æ˜“', 'å®Œå…¨ç„¡æ³•è™•ç†éŒ¢è²¡'] },
                    { id: 'adl9_9', text: 'ç¾åœ¨é‚„åœ¨å¾äº‹ä¾‹è¡Œçš„æ´»å‹•æˆ–å¹³å¸¸çš„å—œå¥½èˆˆè¶£å—ï¼Ÿä¾‹å¦‚é‹å‹•ã€å”¸ä½›ã€ä¸Šæ•™å ‚ã€æ‰“ç‰Œã€éº»å°‡ã€å”±æ­Œã€æˆ–èˆ‡å­«å­å¥³ç©ç­‰', type: 'adl3', options: ['å¦‚å¸¸', 'æœ‰æ¸›å°‘', 'å¹¾ä¹æ²’æœ‰æˆ–å®Œå…¨æ²’æœ‰ï¼Œæ•´å¤©åœ¨è‡ªå·±æˆ¿é–“'] },
                    { id: 'adl9_10', text: 'ä¸Šè¿°æ´»å‹•å›°é›£ï¼Œç—…äººæ˜¯å› è‚¢é«”æˆ–è¡Œå‹•ä¸ä¾¿å—ï¼Ÿ', type: 'yesno' }
                ]
            }
        ];

        // è©•åˆ†æ¬Šé‡
        const scoringWeights = {
            DLB: {
                'dlb1_1': 2.0, 'dlb1_2': 2.0, 'dlb1_3': 3.0, 'dlb1_4': 4.5,
                'dlb2_1': 3.0, 'dlb2_2': 3.5, 'dlb2_3': 3.0, 'dlb2_4': 2.5,
                'dlb3_1': 5.0, 'dlb4_2': 2.0, 'dlb4_3': 2.0
            },
            AD: {
                'ad5_1': 3.5, 'ad5_2': 4.0, 'ad5_3': 3.5, 'ad5_4': 3.0,
                'ad5_5': 2.5, 'ad5_6': 4.0, 'ad5_7': 3.0, 'ad5_8': 2.5,
                'ad6_1': 3.5, 'ad6_2': 3.0, 'ad6_3': 2.5, 'ad6_4': 3.0, 'ad6_5': 2.5,
                'dlb3_2': 1.5, 'dlb3_3': 1.5
            },
            VaD: {
                'vad7_2': 3.5, 'vad7_3': 3.5, 'vad7_4': 3.0, 'vad7_5': 3.0,
                'vad7_6': 2.5, 'vad7_7': 3.0, 'vad4_1': 2.5,
                'dlb2_4': 2.0, 'ad5_1': 1.5, 'ad5_2': 2.0, 'ad5_6': 2.0
            },
            FTD: {
                'ftd7_1': 4.0, 'ftd3_5': 4.0, 'ftd3_6': 4.5, 'ftd3_7': 3.5,
                'ftd3_8': 3.5, 'ftd3_4': 2.5, 'vad7_2': 3.0, 'vad7_4': 3.0,
                'vad7_7': 3.0, 'ftd8_6': 4.0
            },
            PPA: {
                'ppa8_1': 3.5, 'ppa8_2': 3.5, 'ppa8_3': 3.0,
                'ppa8_4': 3.5, 'ppa8_5': 3.0, 'ftd8_6': 5.0
            }
        };

        // åˆå§‹åŒ–æ—¥æœŸ
        document.getElementById('assessmentDate').valueAsDate = new Date();

        // é–‹å§‹è©•ä¼°
        function startAssessment() {
            const name = document.getElementById('patientName').value.trim();
            const chartNumber = document.getElementById('chartNumber').value.trim();
            const birthDate = document.getElementById('birthDate').value;
            const gender = document.getElementById('gender').value;
            const informantName = document.getElementById('informantName').value.trim();
            const informantRelation = document.getElementById('informantRelation').value.trim();

            if (!name || !chartNumber || !birthDate || !gender || !informantName || !informantRelation) {
                alert('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ï¼ˆæ¨™è¨» * è€…ï¼‰');
                return;
            }

            patientInfo = {
                name: name,
                chartNumber: chartNumber,
                birthDate: birthDate,
                gender: gender,
                education: document.getElementById('education').value,
                assessmentDate: document.getElementById('assessmentDate').value,
                informantName: informantName,
                informantRelation: informantRelation
            };

            currentStep = 1;
            showStep(currentStep);
        }

        // é¡¯ç¤ºæ­¥é©Ÿ
        function showStep(step) {
            document.getElementById('step0').classList.add('hidden');
            document.getElementById('questionSteps').classList.remove('hidden');
            document.getElementById('resultsPage').classList.add('hidden');

            const section = questionSections[step - 1];
            let html = '<div class="section-title">' + section.title + '</div>';
            html += '<div class="section-subtitle">' + section.subtitle + '</div>';

            section.questions.forEach(function(q, idx) {
                html += '<div class="question-item">';
                html += '<div class="question-header">';
                html += '<span class="question-number">Q' + (idx + 1) + '</span>';
                html += '<span class="question-text">' + q.text + '</span>';
                html += '</div>';
                if (q.note) {
                    html += '<div class="question-note">' + q.note + '</div>';
                }
                html += renderQuestionInput(q);
                html += '</div>';
            });

            html += '<div class="button-group">';
            html += '<button class="btn btn-secondary" onclick="previousStep()">â† ä¸Šä¸€æ­¥</button>';
            if (step < questionSections.length) {
                html += '<button class="btn btn-primary" onclick="nextStep()">ä¸‹ä¸€æ­¥ â†’</button>';
            } else {
                html += '<button class="btn btn-success" onclick="showResults()">âœ“ å®Œæˆè©•ä¼°</button>';
            }
            html += '</div>';

            document.getElementById('questionSteps').innerHTML = html;
            updateProgress();
            window.scrollTo(0, 0);
        }

        // æ¸²æŸ“å•é¡Œè¼¸å…¥
        function renderQuestionInput(question) {
            const savedValue = responses[question.id];
            let html = '';
            
            switch(question.type) {
                case 'yesno':
                    html = '<div class="radio-group">';
                    html += '<label class="radio-label">';
                    html += '<input type="radio" name="' + question.id + '" value="å¦" ' + (savedValue === 'å¦' ? 'checked' : '') + ' onchange="saveResponse(\'' + question.id + '\', \'å¦\')"> å¦';
                    html += '</label>';
                    html += '<label class="radio-label">';
                    html += '<input type="radio" name="' + question.id + '" value="æ˜¯" ' + (savedValue === 'æ˜¯' ? 'checked' : '') + ' onchange="saveResponse(\'' + question.id + '\', \'æ˜¯\')"> æ˜¯';
                    html += '</label>';
                    html += '</div>';
                    break;
                
                case 'noyes':
                    html = '<div class="radio-group">';
                    html += '<label class="radio-label">';
                    html += '<input type="radio" name="' + question.id + '" value="ä¸æœƒ" ' + (savedValue === 'ä¸æœƒ' ? 'checked' : '') + ' onchange="saveResponse(\'' + question.id + '\', \'ä¸æœƒ\')"> ä¸æœƒ';
                    html += '</label>';
                    html += '<label class="radio-label">';
                    html += '<input type="radio" name="' + question.id + '" value="æœƒ" ' + (savedValue === 'æœƒ' ? 'checked' : '') + ' onchange="saveResponse(\'' + question.id + '\', \'æœƒ\')"> æœƒ';
                    html += '</label>';
                    html += '</div>';
                    break;
                
                case 'frequency3':
                    html = '<div class="radio-group">';
                    html += '<label class="radio-label">';
                    html += '<input type="radio" name="' + question.id + '" value="ä¸æœƒ" ' + (savedValue === 'ä¸æœƒ' ? 'checked' : '') + ' onchange="saveResponse(\'' + question.id + '\', \'ä¸æœƒ\')"> ä¸æœƒ';
                    html += '</label>';
                    html += '<label class="radio-label">';
                    html += '<input type="radio" name="' + question.id + '" value="å¶çˆ¾" ' + (savedValue === 'å¶çˆ¾' ? 'checked' : '') + ' onchange="saveResponse(\'' + question.id + '\', \'å¶çˆ¾\')"> å¶çˆ¾';
                    html += '</label>';
                    html += '<label class="radio-label">';
                    html += '<input type="radio" name="' + question.id + '" value="å¸¸å¸¸" ' + (savedValue === 'å¸¸å¸¸' ? 'checked' : '') + ' onchange="saveResponse(\'' + question.id + '\', \'å¸¸å¸¸\')"> å¸¸å¸¸';
                    html += '</label>';
                    html += '</div>';
                    break;
                
                case 'decision':
                    html = '<div class="radio-group vertical">';
                    html += '<label class="radio-label">';
                    html += '<input type="radio" name="' + question.id + '" value="ä¸æœƒ" ' + (savedValue === 'ä¸æœƒ' ? 'checked' : '') + ' onchange="saveResponse(\'' + question.id + '\', \'ä¸æœƒ\')"> ä¸æœƒï¼Œå¤§éƒ½æ˜¯è‡ªå·±æ±ºå®š';
                    html += '</label>';
                    html += '<label class="radio-label">';
                    html += '<input type="radio" name="' + question.id + '" value="æœƒ" ' + (savedValue === 'æœƒ' ? 'checked' : '') + ' onchange="saveResponse(\'' + question.id + '\', \'æœƒ\')"> æœƒï¼Œå¤§éƒ½ç”±åˆ¥äººå¹«å¿™æ±ºå®š';
                    html += '</label>';
                    html += '</div>';
                    break;
                
                case 'adl3':
                case 'adl4':
                    html = '<div class="radio-group vertical">';
                    question.options.forEach(function(opt, idx) {
                        html += '<label class="radio-label">';
                        html += '<input type="radio" name="' + question.id + '" value="' + idx + '" ' + (savedValue == idx ? 'checked' : '') + ' onchange="saveResponse(\'' + question.id + '\', ' + idx + ')"> ' + opt;
                        html += '</label>';
                    });
                    html += '</div>';
                    break;
            }
            
            return html;
        }

        // å„²å­˜å›æ‡‰
        function saveResponse(questionId, value) {
            responses[questionId] = value;
        }

        // ä¸‹ä¸€æ­¥
        function nextStep() {
            if (currentStep < questionSections.length) {
                currentStep++;
                showStep(currentStep);
            }
        }

        // ä¸Šä¸€æ­¥
        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            } else {
                document.getElementById('step0').classList.remove('hidden');
                document.getElementById('questionSteps').classList.add('hidden');
                currentStep = 0;
                updateProgress();
            }
        }

        // æ›´æ–°é€²åº¦æ¢
        function updateProgress() {
            const progress = (currentStep / questionSections.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = 
                currentStep === 0 ? 'æº–å‚™é–‹å§‹' : 
                'ç¬¬ ' + currentStep + ' éƒ¨åˆ†ï¼Œå…± ' + questionSections.length + ' éƒ¨åˆ† (' + Math.round(progress) + '% å®Œæˆ)';
        }

        // è¨ˆç®—è©•åˆ†
        function calculateScores() {
            const scores = { DLB: 0, AD: 0, VaD: 0, FTD: 0, PPA: 0 };
            const maxScores = { DLB: 0, AD: 0, VaD: 0, FTD: 0, PPA: 0 };

            Object.keys(responses).forEach(function(qId) {
                const value = responses[qId];
                
                Object.keys(scoringWeights).forEach(function(type) {
                    if (scoringWeights[type][qId]) {
                        const weight = scoringWeights[type][qId];
                        maxScores[type] += weight;
                        
                        if (value === 'æ˜¯' || value === 'æœƒ') {
                            scores[type] += weight;
                        } else if (value === 'å¶çˆ¾') {
                            scores[type] += weight * 0.5;
                        } else if (value === 'å¸¸å¸¸') {
                            scores[type] += weight * 1.0;
                        } else if (typeof value === 'number' && value > 0) {
                            scores[type] += weight;
                        }
                    }
                });
            });

            const adlImpairment = calculateADLImpairment();
            const functionalMultiplier = 1 + (adlImpairment / 100);
            Object.keys(scores).forEach(function(type) {
                scores[type] *= functionalMultiplier;
            });

            if (responses['dlb1_4'] === 'æ˜¯' && responses['dlb3_1'] === 'æ˜¯' && responses['dlb1_3'] === 'æœƒ') {
                scores.DLB *= 1.5;
            }
            
            if (responses['ftd7_1'] === 'æœƒ' && responses['ftd3_5'] === 'æ˜¯' && responses['ftd3_6'] === 'æ˜¯') {
                scores.FTD *= 1.4;
            }
            
            if (responses['ftd8_6'] === 'æ˜¯' && 
                (responses['ppa8_1'] === 'å¸¸å¸¸' || responses['ppa8_2'] === 'æœƒ' || responses['ppa8_4'] === 'æœƒ')) {
                scores.PPA *= 1.5;
            }

            const percentages = {};
            Object.keys(scores).forEach(function(type) {
                percentages[type] = maxScores[type] > 0 ? 
                    Math.min(100, (scores[type] / maxScores[type]) * 100) : 0;
            });

            const totalScore = Object.values(percentages).reduce(function(a, b) { return a + b; }, 0);
            const probabilities = {};
            Object.keys(percentages).forEach(function(type) {
                probabilities[type] = totalScore > 0 ? (percentages[type] / totalScore) * 100 : 0;
            });

            return {
                rawScores: scores,
                percentages: percentages,
                probabilities: probabilities,
                adlImpairment: adlImpairment,
                overallRisk: calculateOverallRisk(percentages)
            };
        }

        // è¨ˆç®—ADLéšœç¤™
        function calculateADLImpairment() {
            let impairmentScore = 0;
            let totalItems = 0;
            
            for (let i = 1; i <= 9; i++) {
                const qId = 'adl9_' + i;
                if (responses[qId] !== undefined) {
                    const value = responses[qId];
                    
                    if (typeof value === 'number') {
                        if (qId === 'adl9_3' || qId === 'adl9_4' || qId === 'adl9_5') {
                            if (value === 0) {
                                continue;
                            } else {
                                totalItems++;
                                if (value === 1) {
                                    impairmentScore += 0;
                                } else if (value === 2) {
                                    impairmentScore += 0.5;
                                } else if (value === 3) {
                                    impairmentScore += 1.0;
                                }
                            }
                        } else {
                            totalItems++;
                            if (value === 0) {
                                impairmentScore += 0;
                            } else if (value === 1) {
                                impairmentScore += 0.5;
                            } else if (value >= 2) {
                                impairmentScore += 1.0;
                            }
                        }
                    }
                }
            }
            
            return totalItems > 0 ? (impairmentScore / totalItems) * 100 : 0;
        }

        // è¨ˆç®—æ•´é«”é¢¨éšª
        function calculateOverallRisk(percentages) {
            const maxScore = Math.max.apply(null, Object.values(percentages));
            const avgScore = Object.values(percentages).reduce(function(a, b) { return a + b; }, 0) / 5;
            
            if (maxScore >= 60 && avgScore >= 30) return 'high';
            if (maxScore >= 40 || avgScore >= 20) return 'moderate';
            if (maxScore >= 20 || avgScore >= 10) return 'mild';
            return 'low';
        }

        // ç”Ÿæˆå»ºè­°
        function generateRecommendations(results) {
            const probabilities = results.probabilities;
            const overallRisk = results.overallRisk;
            const adlImpairment = results.adlImpairment;
            const recommendations = [];
            
            const sorted = Object.entries(probabilities)
                .sort(function(a, b) { return b[1] - a[1]; })
                .filter(function(item) { return item[1] > 15; });

            if (overallRisk === 'high') {
                recommendations.push({
                    type: 'urgent',
                    text: 'å»ºè­°ç›¡å¿«ï¼ˆ2é€±å…§ï¼‰å®‰æ’ç¥ç¶“å…§ç§‘æˆ–è€å¹´ç²¾ç¥ç§‘å°ˆç§‘é†«å¸«è©•ä¼°'
                });
            } else if (overallRisk === 'moderate') {
                recommendations.push({
                    type: 'important',
                    text: 'å»ºè­°æ–¼1å€‹æœˆå…§è‡³è¨˜æ†¶é–€è¨ºæˆ–ç¥ç¶“ç§‘æ¥å—å®Œæ•´è©•ä¼°'
                });
            }

            if (adlImpairment > 50) {
                recommendations.push({
                    type: 'important',
                    text: 'æ—¥å¸¸åŠŸèƒ½æ˜é¡¯å—æï¼Œå»ºè­°è©•ä¼°ç…§è­·éœ€æ±‚èˆ‡å®‰å…¨æªæ–½'
                });
            }

            if (probabilities.DLB > 30) {
                recommendations.push({
                    type: 'clinical',
                    text: 'ç—‡ç‹€ç¬¦åˆLewy Bodyå¤±æ™ºç—‡ç‰¹å¾µï¼Œå»ºè­°é€²è¡ŒDaTscanæˆ–MIBGå¿ƒè‚Œé–ƒçˆæ”å½±æª¢æŸ¥'
                });
                if (responses['dlb1_4'] === 'æ˜¯') {
                    recommendations.push({
                        type: 'safety',
                        text: 'æœ‰REMç¡çœ è¡Œç‚ºéšœç¤™ï¼Œæ³¨æ„ç¡çœ å®‰å…¨ï¼Œé¿å…åºŠé‚Šæ”¾ç½®å±éšªç‰©å“'
                    });
                }
            }

            if (probabilities.AD > 30 && responses['ad5_2'] === 'æœƒ') {
                recommendations.push({
                    type: 'clinical',
                    text: 'è¨˜æ†¶éšœç¤™é¡¯è‘—ï¼Œå»ºè­°è€ƒæ…®è…¦éƒ¨MRIåŠè¡€æ¶²ç”Ÿç‰©æ¨™è¨˜(å¦‚plasma p-tau217)æª¢æ¸¬'
                });
            }

            if (probabilities.FTD > 30) {
                const age = calculateAge(patientInfo.birthDate);
                if (age && age < 65) {
                    recommendations.push({
                        type: 'clinical',
                        text: 'å¹´è¼•ç™¼ç—…ä¸”æœ‰æ˜é¡¯è¡Œç‚ºæ”¹è®Šï¼Œå»ºè­°åŸºå› æª¢æ¸¬è©•ä¼°éºå‚³æ€§é¡é¡³è‘‰å¤±æ™ºç—‡'
                    });
                }
            }

            if (probabilities.PPA > 30) {
                recommendations.push({
                    type: 'clinical',
                    text: 'èªè¨€åŠŸèƒ½éšœç¤™ç‚ºä¸»è¦ç—‡ç‹€ï¼Œå»ºè­°èªè¨€æ²»ç™‚è©•ä¼°åŠPETå½±åƒæª¢æŸ¥'
                });
            }

            return { sorted: sorted, recommendations: recommendations };
        }

        // è¨ˆç®—å¹´é½¡
        function calculateAge(birthDate) {
            if (!birthDate) return null;
            const birth = new Date(birthDate);
            const today = new Date();
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            return age;
        }

        // ç²å–ç•°å¸¸ç—‡ç‹€
        function getAbnormalSymptoms() {
            const abnormalSymptoms = [];
            
            questionSections.forEach(function(section) {
                section.questions.forEach(function(q) {
                    const value = responses[q.id];
                    let isAbnormal = false;
                    
                    if (value === 'æ˜¯' || value === 'æœƒ' || value === 'å¸¸å¸¸') {
                        isAbnormal = true;
                    } else if (typeof value === 'number' && value > 0) {
                        if (q.type === 'adl4') {
                            isAbnormal = (value === 3);
                        } else if (q.type === 'adl3') {
                            isAbnormal = (value === 2);
                        } else {
                            isAbnormal = true;
                        }
                    }
                    
                    if (isAbnormal) {
                        let responseText = value;
                        if (q.type === 'adl3' || q.type === 'adl4') {
                            responseText = q.options[value] || value;
                        }
                        
                        abnormalSymptoms.push({
                            section: section.title,
                            question: q.text,
                            response: responseText
                        });
                    }
                });
            });
            
            return abnormalSymptoms;
        }

        // å¤±æ™ºç—‡åç¨±
        function getDementiaName(type) {
            const names = {
                'AD': "Alzheimer's Disease (é˜¿èŒ²æµ·é»˜ç—‡)",
                'DLB': 'Dementia with Lewy Bodies (è·¯æ˜“æ°é«”å¤±æ™ºç—‡)',
                'VaD': 'Vascular Dementia (è¡€ç®¡æ€§å¤±æ™ºç—‡)',
                'FTD': 'Frontotemporal Dementia (é¡é¡³è‘‰å¤±æ™ºç—‡)',
                'PPA': 'Primary Progressive Aphasia (åŸç™¼æ€§é€²è¡Œæ€§å¤±èªç—‡)'
            };
            return names[type] || type;
        }

        // é¢¨éšªæ–‡å­—å’Œé¡è‰²
        function getRiskInfo(risk) {
            const info = {
                'high': { text: 'é«˜åº¦é¢¨éšª', color: 'risk-high' },
                'moderate': { text: 'ä¸­åº¦é¢¨éšª', color: 'risk-moderate' },
                'mild': { text: 'è¼•åº¦é¢¨éšª', color: 'risk-mild' },
                'low': { text: 'ä½é¢¨éšª', color: 'risk-low' }
            };
            return info[risk] || info['low'];
        }

        // é¡¯ç¤ºçµæœ
        function showResults() {
            const results = calculateScores();
            const recsData = generateRecommendations(results);
            const sorted = recsData.sorted;
            const recommendations = recsData.recommendations;
            const abnormalSymptoms = getAbnormalSymptoms();
            const riskInfo = getRiskInfo(results.overallRisk);

            let html = '<div class="results-container">';
            html += '<div class="section-title">ğŸ“Š è©•ä¼°çµæœå ±å‘Š</div>';
            
            html += '<div class="risk-card">';
            html += '<h3 style="margin-bottom: 15px;">æ•´é«”è©•ä¼°æ‘˜è¦</h3>';
            html += '<div class="risk-summary">';
            html += '<div class="risk-item">';
            html += '<div class="risk-label">æ•´é«”èªçŸ¥éšœç¤™é¢¨éšªç­‰ç´š</div>';
            html += '<div class="risk-value ' + riskInfo.color + '">' + riskInfo.text + '</div>';
            html += '</div>';
            html += '<div class="risk-item">';
            html += '<div class="risk-label">æ—¥å¸¸åŠŸèƒ½éšœç¤™ç¨‹åº¦</div>';
            html += '<div class="risk-value" style="color: #8b5cf6;">' + results.adlImpairment.toFixed(1) + '%</div>';
            html += '</div>';
            html += '</div>';
            html += '</div>';

            html += '<div class="risk-card">';
            html += '<h3 style="margin-bottom: 15px;">å„é¡å‹å¤±æ™ºç—‡ç›¸å°æ©Ÿç‡åˆ†æ</h3>';
            html += '<div class="probability-bars">';

            sorted.forEach(function(item) {
                const type = item[0];
                const prob = item[1];
                html += '<div class="probability-item">';
                html += '<div class="probability-header">';
                html += '<span class="probability-name">' + getDementiaName(type) + '</span>';
                html += '<span class="probability-percent">' + prob.toFixed(1) + '%</span>';
                html += '</div>';
                html += '<div class="probability-bar">';
                html += '<div class="probability-fill" style="width: ' + prob + '%;">';
                html += (prob > 10 ? prob.toFixed(1) + '%' : '');
                html += '</div>';
                html += '</div>';
                html += '</div>';
            });

            html += '</div>';
            html += '</div>';

            html += '<div class="risk-card">';
            html += '<h3 style="margin-bottom: 15px;">ğŸ©º è‡¨åºŠå»ºè­°</h3>';
            html += '<div class="recommendations">';

            recommendations.forEach(function(rec) {
                const recClass = rec.type === 'urgent' ? 'rec-urgent' :
                                rec.type === 'important' ? 'rec-important' :
                                rec.type === 'clinical' ? 'rec-clinical' : 'rec-safety';
                const icon = rec.type === 'urgent' ? 'âš ï¸' :
                            rec.type === 'important' ? 'â–¶ï¸' :
                            rec.type === 'clinical' ? 'ğŸ“‹' : 'ğŸ›¡ï¸';
                
                html += '<div class="recommendation-item ' + recClass + '">';
                html += '<div class="rec-title">' + icon + ' ';
                html += (rec.type === 'urgent' ? 'é‡è¦' :
                         rec.type === 'important' ? 'å»ºè­°' :
                         rec.type === 'clinical' ? 'è‡¨åºŠæª¢æŸ¥' : 'å®‰å…¨æé†’');
                html += '</div>';
                html += '<div>' + rec.text + '</div>';
                html += '</div>';
            });

            html += '</div>';
            html += '</div>';

            html += '<div class="risk-card">';
            html += '<h3 style="margin-bottom: 15px;">âš•ï¸ ç•°å¸¸ç—‡ç‹€æ¸…å–®</h3>';
            if (abnormalSymptoms.length > 0) {
                html += '<table class="symptoms-table">';
                html += '<thead><tr>';
                html += '<th>ç—‡ç‹€é ˜åŸŸ</th>';
                html += '<th>é …ç›®</th>';
                html += '<th>å›ç­”</th>';
                html += '</tr></thead>';
                html += '<tbody>';
                abnormalSymptoms.forEach(function(symptom) {
                    html += '<tr>';
                    html += '<td>' + symptom.section + '</td>';
                    html += '<td>' + symptom.question + '</td>';
                    html += '<td class="symptom-positive">' + symptom.response + '</td>';
                    html += '</tr>';
                });
                html += '</tbody>';
                html += '</table>';
            } else {
                html += '<p style="color: #16a34a; font-weight: 600;">âœ“ æœªç™¼ç¾æ˜é¡¯ç•°å¸¸ç—‡ç‹€</p>';
            }
            html += '</div>';

            html += '<div class="disclaimer">';
            html += '<h3>âš ï¸ é‡è¦è²æ˜</h3>';
            html += '<ul>';
            html += '<li>æœ¬å·¥å…·åƒ…ä¾›åˆæ­¥ç¯©æª¢ä½¿ç”¨ï¼Œä¸èƒ½å–ä»£å°ˆæ¥­é†«ç™‚è¨ºæ–·</li>';
            html += '<li>å¤±æ™ºç—‡è¨ºæ–·éœ€è¦å®Œæ•´çš„ç¥ç¶“å­¸æª¢æŸ¥ã€èªçŸ¥åŠŸèƒ½è©•ä¼°ã€è…¦éƒ¨å½±åƒåŠå¯¦é©—å®¤æª¢æŸ¥</li>';
            html += '<li>è©•ä¼°çµæœå—æ•™è‚²ç¨‹åº¦ã€æ–‡åŒ–èƒŒæ™¯ã€å¹´é½¡ç­‰å› ç´ å½±éŸ¿</li>';
            html += '<li>è«‹å‹™å¿…å°‡æœ¬å ±å‘Šæä¾›çµ¦å°ˆç§‘é†«å¸«ï¼Œé€²è¡Œå®Œæ•´çš„è‡¨åºŠè©•ä¼°</li>';
            html += '<li>è‹¥æœ‰æ€¥æ€§æ„è­˜æ”¹è®Šã€åš´é‡è¨˜æ†¶å–ªå¤±æˆ–å…¶ä»–ç·Šæ€¥ç—‡ç‹€ï¼Œè«‹ç«‹å³å°±é†«</li>';
            html += '</ul>';
            html += '</div>';

            html += '<div class="info-box">';
            html += '<h3>ğŸ“Š è³‡æ–™æ”¶é›†èˆ‡åˆ†æèªªæ˜</h3>';
            html += '<ul>';
            html += '<li><strong>ä¸‹è¼‰å ±å‘Š</strong>ï¼šé»æ“Šã€Œä¸‹è¼‰å ±å‘Šã€æœƒè‡ªå‹•ä¸‹è¼‰æ–‡å­—æª”ï¼Œå®Œæˆå¾Œè©¢å•æ˜¯å¦è¿”å›é¦–é </li>';
            html += '<li><strong>åŒ¯å‡ºå€‹æ¡ˆè³‡æ–™</strong>ï¼šé»æ“Šã€ŒåŒ¯å‡ºè³‡æ–™ã€å¯ä¸‹è¼‰JSONæ ¼å¼çš„å®Œæ•´è©•ä¼°è³‡æ–™</li>';
            html += '<li><strong>è¿”å›ä¿®æ”¹</strong>ï¼šå¯è¿”å›ä»»ä½•æ­¥é©Ÿä¿®æ”¹ç­”æ¡ˆï¼Œæ‰€æœ‰å·²å¡«è³‡æ–™éƒ½æœƒä¿ç•™</li>';
            html += '<li><strong>ç”¨æ–¼ç ”ç©¶åˆ†æ</strong>ï¼šæ”¶é›†å¤šå€‹å€‹æ¡ˆçš„JSONæª”æ¡ˆå¾Œï¼Œå¯ä½¿ç”¨çµ±è¨ˆè»Ÿé«”ï¼ˆå¦‚Rã€Pythonã€SPSSï¼‰é€²è¡Œæ‰¹æ¬¡åˆ†æ</li>';
            html += '<li><strong>è³‡æ–™æ¬„ä½åŒ…å«</strong>ï¼šåŸºæœ¬è³‡æ–™ã€æ‰€æœ‰å•é¡Œå›ç­”ã€è¨ˆç®—åˆ†æ•¸ã€é¢¨éšªè©•ä¼°ç­‰å®Œæ•´è³‡è¨Š</li>';
            html += '<li><strong>éš±ç§ä¿è­·</strong>ï¼šåœ¨é€²è¡Œè³‡æ–™æ”¶é›†å‰ï¼Œè«‹ç¢ºä¿å·²å–å¾—é©ç•¶çš„å€«ç†å¯©æŸ¥èˆ‡å—è©¦è€…åŒæ„</li>';
            html += '</ul>';
            html += '</div>';

            html += '<div class="button-group">';
            html += '<button class="btn btn-secondary" onclick="backToEdit()">âœï¸ è¿”å›ä¿®æ”¹</button>';
            html += '<button class="btn btn-primary" onclick="downloadTextReport()">ğŸ“¥ ä¸‹è¼‰å ±å‘Š</button>';
            html += '<button class="btn btn-success" onclick="uploadDataToGitHub()">â˜ï¸ ä¸Šå‚³åˆ°é›²ç«¯</button>';
            html += '<button class="btn btn-secondary" onclick="restartAssessment()">ğŸ”„ é‡æ–°é–‹å§‹</button>';
            html += '</div>';

            document.getElementById('questionSteps').classList.add('hidden');
            document.getElementById('resultsPage').innerHTML = html;
            document.getElementById('resultsPage').classList.remove('hidden');
            document.getElementById('progressFill').style.width = '100%';
            document.getElementById('progressText').textContent = 'è©•ä¼°å®Œæˆ';
            window.scrollTo(0, 0);
        }

        // è¿”å›ä¿®æ”¹ç­”æ¡ˆ
        function backToEdit() {
            document.getElementById('resultsPage').classList.add('hidden');
            currentStep = 1;
            showStep(currentStep);
            window.scrollTo(0, 0);
        }

        // ä¸‹è¼‰æ–‡å­—å ±å‘Š
        function downloadTextReport() {
            const results = calculateScores();
            const recsData = generateRecommendations(results);
            const sorted = recsData.sorted;
            const recommendations = recsData.recommendations;
            const abnormalSymptoms = getAbnormalSymptoms();
            const riskInfo = getRiskInfo(results.overallRisk);
            const age = calculateAge(patientInfo.birthDate);

            let report = '\n';
            report += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
            report += '              è‡¨åºŠç—…å²å¤±æ™ºè¨ºæ–·çµæ§‹æ€§å•å· - è©•ä¼°å ±å‘Š\n';
            report += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
            report += 'ã€åŸºæœ¬è³‡æ–™ã€‘\n';
            report += 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n';
            report += 'ç—…æ‚£å§“åï¼š' + patientInfo.name + '\n';
            report += 'ç—…æ­·è™Ÿï¼š' + patientInfo.chartNumber + '\n';
            report += 'å‡ºç”Ÿæ—¥æœŸï¼š' + patientInfo.birthDate + (age ? ' (' + age + 'æ­²)' : '') + '\n';
            report += 'æ€§åˆ¥ï¼š' + patientInfo.gender + '\n';
            report += 'æ•™è‚²ç¨‹åº¦ï¼š' + (patientInfo.education || 'æœªå¡«å¯«') + '\n';
            report += 'è©•ä¼°æ—¥æœŸï¼š' + patientInfo.assessmentDate + '\n';
            report += 'è³‡è¨Šæä¾›è€…ï¼š' + patientInfo.informantName + 'ï¼ˆ' + patientInfo.informantRelation + 'ï¼‰\n\n';
            report += 'ã€è©•ä¼°çµæœæ‘˜è¦ã€‘\n';
            report += 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n';
            report += 'æ•´é«”èªçŸ¥éšœç¤™é¢¨éšªç­‰ç´šï¼š' + riskInfo.text + '\n';
            report += 'æ—¥å¸¸åŠŸèƒ½éšœç¤™ç¨‹åº¦ï¼š' + results.adlImpairment.toFixed(1) + '%\n\n';
            report += 'ã€å„é¡å‹å¤±æ™ºç—‡ç›¸å°æ©Ÿç‡åˆ†æã€‘\n';
            report += 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n';

            sorted.forEach(function(item) {
                const type = item[0];
                const prob = item[1];
                report += getDementiaName(type) + 'ï¼š' + prob.toFixed(1) + '%\n';
            });

            report += '\nã€è‡¨åºŠå»ºè­°ã€‘\n';
            report += 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n';

            recommendations.forEach(function(rec, idx) {
                const label = rec.type === 'urgent' ? 'âš  é‡è¦' :
                             rec.type === 'important' ? 'â–¶ å»ºè­°' :
                             rec.type === 'clinical' ? 'ğŸ“‹ è‡¨åºŠæª¢æŸ¥' : 'ğŸ›¡ å®‰å…¨æé†’';
                report += (idx + 1) + '. [' + label + '] ' + rec.text + '\n\n';
            });

            report += '\nã€ç•°å¸¸ç—‡ç‹€æ¸…å–®ã€‘\n';
            report += 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n';

            if (abnormalSymptoms.length > 0) {
                abnormalSymptoms.forEach(function(symptom, idx) {
                    report += (idx + 1) + '. ' + symptom.section + '\n';
                    report += '   å•é¡Œï¼š' + symptom.question + '\n';
                    report += '   å›ç­”ï¼š' + symptom.response + '\n\n';
                });
            } else {
                report += 'æœªç™¼ç¾æ˜é¡¯ç•°å¸¸ç—‡ç‹€\n\n';
            }

            report += '\nã€é‡è¦è²æ˜ã€‘\n';
            report += 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n';
            report += 'âš  æœ¬å·¥å…·åƒ…ä¾›åˆæ­¥ç¯©æª¢ä½¿ç”¨ï¼Œä¸èƒ½å–ä»£å°ˆæ¥­é†«ç™‚è¨ºæ–·\n\n';
            report += '1. å¤±æ™ºç—‡è¨ºæ–·éœ€è¦å®Œæ•´çš„ç¥ç¶“å­¸æª¢æŸ¥ã€èªçŸ¥åŠŸèƒ½è©•ä¼°ã€è…¦éƒ¨å½±åƒ\n';
            report += '   åŠå¯¦é©—å®¤æª¢æŸ¥\n\n';
            report += '2. è©•ä¼°çµæœå—æ•™è‚²ç¨‹åº¦ã€æ–‡åŒ–èƒŒæ™¯ã€å¹´é½¡ç­‰å› ç´ å½±éŸ¿\n\n';
            report += '3. è«‹å‹™å¿…å°‡æœ¬å ±å‘Šæä¾›çµ¦å°ˆç§‘é†«å¸«ï¼Œé€²è¡Œå®Œæ•´çš„è‡¨åºŠè©•ä¼°\n\n';
            report += '4. è‹¥æœ‰æ€¥æ€§æ„è­˜æ”¹è®Šã€åš´é‡è¨˜æ†¶å–ªå¤±æˆ–å…¶ä»–ç·Šæ€¥ç—‡ç‹€ï¼Œè«‹ç«‹å³å°±é†«\n\n';
            report += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
            report += 'å ±å‘Šç”Ÿæˆæ™‚é–“ï¼š' + new Date().toLocaleString('zh-TW') + '\n';
            report += 'æœ¬å ±å‘Šç”±AIè¼”åŠ©è©•ä¼°å·¥å…·ç”Ÿæˆï¼Œåƒ…ä¾›è‡¨åºŠåƒè€ƒ\n';
            report += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';

            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'å¤±æ™ºç—‡è©•ä¼°å ±å‘Š_' + patientInfo.name + '_' + patientInfo.assessmentDate + '.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            setTimeout(function() {
                if (confirm('å ±å‘Šå·²é–‹å§‹ä¸‹è¼‰ï¼\n\næ˜¯å¦è¦è¿”å›é¦–é é‡æ–°è©•ä¼°ï¼Ÿ')) {
                    restartAssessment();
                }
            }, 500);
        }

        // åŒ¯å‡ºJSONè³‡æ–™
        function downloadJSONData() {
            const results = calculateScores();
            const recsData = generateRecommendations(results);
            const sorted = recsData.sorted;
            const recommendations = recsData.recommendations;
            const abnormalSymptoms = getAbnormalSymptoms();
            const age = calculateAge(patientInfo.birthDate);

            const exportData = {
                metadata: {
                    exportDate: new Date().toISOString(),
                    assessmentDate: patientInfo.assessmentDate,
                    toolVersion: '2.0'
                },
                patientInfo: Object.assign({}, patientInfo, { age: age }),
                responses: responses,
                results: {
                    overallRisk: results.overallRisk,
                    adlImpairment: results.adlImpairment,
                    rawScores: results.rawScores,
                    percentages: results.percentages,
                    probabilities: results.probabilities,
                    dementiaTypeProbabilities: sorted.map(function(item) {
                        return {
                            type: item[0],
                            name: getDementiaName(item[0]),
                            probability: item[1]
                        };
                    })
                },
                abnormalSymptoms: abnormalSymptoms,
                recommendations: recommendations.map(function(rec) {
                    return {
                        type: rec.type,
                        text: rec.text
                    };
                })
            };

            const jsonString = JSON.stringify(exportData, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'è©•ä¼°è³‡æ–™_' + patientInfo.name + '_' + patientInfo.assessmentDate + '_' + Date.now() + '.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            setTimeout(function() {
                if (confirm('ğŸ’¾ è³‡æ–™å·²ä¸‹è¼‰åˆ°æœ¬æ©Ÿ\n\nğŸ“¤ æ˜¯å¦è¦åŒæ™‚ä¸Šå‚³åˆ° GitHub é€²è¡Œè‡ªå‹•çµ±è¨ˆåˆ†æï¼Ÿ')) {
                    const filename = 'è©•ä¼°è³‡æ–™_' + patientInfo.chartNumber + '_' + Date.now() + '.json';
                    uploadToGitHub(jsonString, filename);
                }
                
                setTimeout(function() {
                    if (confirm('æ˜¯å¦è¦è¿”å›é¦–é é‡æ–°è©•ä¼°ï¼Ÿ')) {
                        restartAssessment();
                    }
                }, 1000);
            }, 500);
        }

        // é‡æ–°è©•ä¼°
        function restartAssessment() {
            currentStep = 0;
            responses = {};
            patientInfo = {};
            document.getElementById('resultsPage').classList.add('hidden');
            document.getElementById('questionSteps').classList.add('hidden');
            document.getElementById('step0').classList.remove('hidden');
            document.getElementById('patientName').value = '';
            document.getElementById('chartNumber').value = '';
            document.getElementById('birthDate').value = '';
            document.getElementById('gender').value = '';
            document.getElementById('education').value = '';
            document.getElementById('assessmentDate').valueAsDate = new Date();
            document.getElementById('informantName').value = '';
            document.getElementById('informantRelation').value = '';
            updateProgress();
            window.scrollTo(0, 0);
        }

        // åˆå§‹åŒ–
        // ä¸Šå‚³åˆ° GitHub
        function uploadToGitHub(jsonData, filename) {
            const repoOwner = 'a7662888';
            const repoName = 'dementia-assessment';
            const branch = 'main';
            
            // å¾ localStorage è®€å– token
            let token = localStorage.getItem('github_token');
            
            if (!token) {
                token = prompt('âš™ï¸ GitHub è¨­å®š\n\nè«‹è¼¸å…¥æ‚¨çš„ GitHub Personal Access Token\n\nğŸ“ å¦‚ä½•å–å¾— Token:\n1. GitHub â†’ Settings â†’ Developer settings\n2. Personal access tokens â†’ Tokens (classic)\n3. Generate new token\n4. æ¬Šé™é¸æ“‡: repo (Full control)\n\nğŸ’¡ Token æœƒå®‰å…¨å„²å­˜åœ¨æœ¬æ©Ÿï¼Œä¸‹æ¬¡ä¸ç”¨å†è¼¸å…¥');
                
                if (!token) {
                    return;
                }
                
                // å„²å­˜ token
                if (confirm('æ˜¯å¦è¦å°‡ Token å„²å­˜åœ¨æœ¬æ©Ÿï¼Ÿ\n(ä¸‹æ¬¡ä½¿ç”¨å°±ä¸ç”¨å†è¼¸å…¥)')) {
                    localStorage.setItem('github_token', token);
                }
            }
            
            // Base64 ç·¨ç¢¼
            const content = btoa(unescape(encodeURIComponent(jsonData)));
            
            const url = 'https://api.github.com/repos/' + repoOwner + '/' + repoName + '/contents/data/' + filename;
            
            // é¡¯ç¤ºä¸Šå‚³ä¸­è¨Šæ¯
            const uploadMsg = document.createElement('div');
            uploadMsg.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(59, 130, 246, 0.95); color: white; padding: 30px; border-radius: 15px; z-index: 10000; text-align: center; font-size: 18px; box-shadow: 0 10px 40px rgba(0,0,0,0.3);';
            uploadMsg.innerHTML = 'â³ æ­£åœ¨ä¸Šå‚³åˆ° GitHub...<br><small style="font-size: 14px; opacity: 0.9;">è«‹ç¨å€™</small>';
            document.body.appendChild(uploadMsg);
            
            fetch(url, {
                method: 'PUT',
                headers: {
                    'Authorization': 'token ' + token,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: 'ğŸ“ æ–°å¢è©•ä¼°è³‡æ–™: ' + patientInfo.name + ' (' + patientInfo.assessmentDate + ')',
                    content: content,
                    branch: branch
                })
            })
            .then(function(response) {
                document.body.removeChild(uploadMsg);
                
                if (response.ok) {
                    alert('âœ… ä¸Šå‚³æˆåŠŸï¼\n\nè³‡æ–™å·²ä¸Šå‚³åˆ° GitHub\nç³»çµ±å°‡è‡ªå‹•ç”Ÿæˆçµ±è¨ˆå ±è¡¨\n\nğŸ“Š ç´„ 1-2 åˆ†é˜å¾Œå¯è‡³ reports/ è³‡æ–™å¤¾æŸ¥çœ‹\n\nğŸ”— Repository: https://github.com/' + repoOwner + '/' + repoName);
                } else if (response.status === 401) {
                    localStorage.removeItem('github_token');
                    throw new Error('Token ç„¡æ•ˆæˆ–å·²éæœŸï¼Œè«‹é‡æ–°è¼¸å…¥');
                } else if (response.status === 422) {
                    throw new Error('æª”æ¡ˆå·²å­˜åœ¨ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–ä¿®æ”¹æª”æ¡ˆåç¨±');
                } else {
                    return response.json().then(function(err) {
                        throw new Error(err.message || 'ä¸Šå‚³å¤±æ•—');
                    });
                }
            })
            .catch(function(error) {
                if (uploadMsg.parentNode) {
                    document.body.removeChild(uploadMsg);
                }
                
                alert('âŒ ä¸Šå‚³å¤±æ•—\n\néŒ¯èª¤è¨Šæ¯: ' + error.message + '\n\nè«‹ç¢ºèª:\nâœ“ Token æ˜¯å¦æ­£ç¢º\nâœ“ Repository æ¬Šé™æ˜¯å¦è¶³å¤ \nâœ“ ç¶²è·¯é€£ç·šæ˜¯å¦æ­£å¸¸');
                
                if (error.message.includes('Token')) {
                    localStorage.removeItem('github_token');
                }
            });
        }
        
// æ¸…é™¤å„²å­˜çš„ Token
        function clearGitHubToken() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤å·²å„²å­˜çš„ GitHub Token å—ï¼Ÿ')) {
                localStorage.removeItem('github_token');
                alert('âœ… Token å·²æ¸…é™¤');
            }
        }
        
        // åŒ…è£å‡½æ•¸ï¼šæº–å‚™è³‡æ–™ä¸¦ä¸Šå‚³åˆ°GitHub
        function uploadDataToGitHub() {
            const results = calculateScores();
            const recsData = generateRecommendations(results);
            const abnormalSymptoms = getAbnormalSymptoms();
            const age = calculateAge(patientInfo.birthDate);
            
            // æº–å‚™å®Œæ•´çš„è³‡æ–™ç‰©ä»¶
            const exportData = {
                metadata: {
                    exportDate: new Date().toISOString(),
                    assessmentDate: patientInfo.assessmentDate,
                    toolVersion: '2.0'
                },
                patientInfo: Object.assign({}, patientInfo, { age: age }),
                responses: responses,
                results: {
                    overallRisk: results.overallRisk,
                    adlImpairment: results.adlImpairment,
                    rawScores: results.rawScores,
                    percentages: results.percentages,
                    probabilities: results.probabilities,
                    dementiaTypeProbabilities: recsData.sorted.map(function(item) {
                        return {
                            type: item[0],
                            name: getDementiaName(item[0]),
                            probability: item[1]
                        };
                    })
                },
                abnormalSymptoms: abnormalSymptoms,
                recommendations: recsData.recommendations.map(function(rec) {
                    return {
                        type: rec.type,
                        text: rec.text
                    };
                })
            };
            
            // ç”Ÿæˆå”¯ä¸€çš„æª”æ¡ˆåç¨±
            const timestamp = Date.now();
            const filename = `assessment_${patientInfo.chartNumber}_${timestamp}.json`;
            
            // è½‰æ›ç‚º JSON å­—ä¸²
            const jsonString = JSON.stringify(exportData, null, 2);
            
            // èª¿ç”¨ç¾æœ‰çš„ä¸Šå‚³å‡½æ•¸
            uploadToGitHub(jsonString, filename);
        }
        
        updateProgress();
    </script>
</body>
</html>
